global:
  # slack_api_url: ''

templates:
  - '/config/*.tmpl'

receivers:
  - name: devnull
  - name: 'Telegram Bot Alert'
    telegram_configs:
    - api_url: https://api.telegram.org
      bot_token: '7427610441:AAEXu_lh6F_JRtNdWsf4DloHD3rNd-3Xan0'
      chat_id: -100221246265
      send_resolved: true
      message: '{{ template "telegram.deployment.resource" . }}'

route:
  group_wait: 10s
  group_interval: 5m
  receiver: devnull
  repeat_interval: 3h
  group_by: 
    - deployment

  routes: 
    - match:
        alertname: DeploymentReachingMemoryLimit
      receiver: 'Telegram Bot Alert'

templates: 
alertmanager.tmpl: |
  {{ define "telegram.deployment.resource" }}
  {{ if eq .Status "firing" }}{{ range .Alerts }}
  {{ .Annotations.message }} ðŸ”¥
  *Severity:* `{{ .Labels.severity}}`
  *Cluster:* `{{ .Labels.cluster }}`
  *Namespace:* `{{ .Labels.namespace }}`
  {{ end }}

  {{ else }}{{ range .Alerts }}
  {{ .Annotations.resolved }} âœ…
  *Cluster:* `{{ .Labels.cluster }}`
  *Namespace:* `{{ .Labels.namespace }}`
  {{ end }}

  {{ end }}
  {{ end }}
